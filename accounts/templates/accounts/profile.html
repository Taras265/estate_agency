{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% load objects_tags %}

{% block title %}{% translate 'Profile' %}{% endblock %}

{% block content %}
<div class="container-fluid page_heading_banner">
  <div class="banner_caption">
    <h1>{% translate 'Profile' %}</h1>
    <ul>
      <li><a href="{% url 'main' lang=lang %}">{% translate 'Main' %}</a></li>
      <li>{% translate 'Profile' %}</li>
    </ul>
  </div>
</div>
    <!-- Page Heading Banner End -->
<div class="container agents_details_section">
    <div class="property_search propertylist_search_section">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            {% if users %}
                <li class="nav-item" role="presentation">
                    <a class="nav-link"
                    href="{% url 'accounts:office_user_list' lang=lang %}">
                        {% translate "Users" %}
                    </a>
                </li>
            {% endif %}
            <li class="nav-item" role="presentation">
                <a class="nav-link active"
                   href="{% url 'accounts:profile' lang=lang %}">
                    {% translate "Profile" %}
                </a>
            </li>
        </ul>
    </div>
</div>
    <!-- Agent Details Section -->
<div class="container agents_details_section">
    <!-- Agent Title -->
    <div class="agents_details">
        <div>
            <img class="img-fluid" src="{{ user.image.url }}" alt="user">
        </div>
        <div>
            <div class="agent_title">
                <div>
                    <h4>
                        {{ user.first_name }} {{ user.last_name }}
                    </h4>
                    <div class="agent_desc">
                        <ul>
                            {% for filial in user.filials.all %}
                                <li>{{ filial.filial_agency }}{% if not forloop.last %}, {% endif %}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            <ul class="basic_detail">
                <li>
                    {% translate 'Phone' %} :
                    {% for phone_number in user.phone_numbers.all %}
                        <span>{{ phone_number.number }}{% if not forloop.last %}, {% endif %}</span>
                    {% empty %}
                        -
                    {% endfor %}
                </li>
                <li>{% translate 'Email' %} : <span>{{ user.email }}</span></li>
            </ul>
        </div>
        <form enctype="multipart/form-data" action="{{ action }}" method="post">{% csrf_token %}
            <div class="offset-top-10">
                {{ form.as_p }}
                <br>
                <input class="custombtn" type=submit value="{% translate 'New avatar' %}">
            </div>
        </form>
    </div>
    {% if objects %}
        <div class="container featured_property_section">
        <div class="container featured_property_section properties_list_section">
        <h2>{% translate "My sold real estate" %}</h2>
        {% for object in objects %}
        <div class="featured_div">
            <div id="carousel{{ object.object.id }}" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    {% for image in object.object.images.all %}  {# Проходимся по всем изображениям объекта #}
                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                            <img class="d-block w-100" src="{{ image.image.url }}" alt="img" style="height: 200px; object-fit: cover;">
                        </div>
                    {% endfor %}
                </div>
                <!-- Кнопки управления -->
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ object.object.id }}" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ object.object.id }}" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                </button>
            </div>
            <div class="featured_content">
                <h2>{{ object.object.street }} {{ object.object.locality_district }} {{ object.object.locality }}</h2>
                <p>{% translate 'id' %}: {{ object.object.id }}</p>
                {% if object.object.house_type %}<p>{% translate 'house_type' %}: {{ object.object.house_type }}</p>{% endif %}
                <p><span><i class='bx bx-map'></i></span>{% if object.object.locality %}{{ object.object.locality }}, {% endif %}{% if object.object.locality_district %}{{ object.object.locality_district }}, {% endif %}{% if object.object.street %}{{ object.object.street }}, {% endif %}{% if object.object.house %}{{ object.object.house }} {% translate 'house' %}{% endif %}{% if object.object.floor > 0 %}, {{ object.object.floor }} {% translate 'floor' %}{% endif %}</p>
                <ul class="property_spec">
                    <li><span><img src="{% static '/images/sq_icon.png' %}" alt="icon"></span> {{ object.object.square }} Sq. M.</li>
                </ul>
            </div>
            <div class="property_price">
                <div class="price_div">
                    <p>₴{{ object.object.price }}</p>
                </div>
                {% get_model_name object.object as model_name %}
            </div>
        </div>
        {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}